name: Sync Upstream and Merge

on:
  push:
    branches:
      - main
  schedule:
    - cron: '0 0 * * *' # Runs every day at midnight
  workflow_dispatch:   # Allows you to run it manually from the Actions tab

jobs:
  sync-and-merge:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
      - name: Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 # Essential to fetch all history and branches

      - name: Configure Git
        run: |
          git config user.name "github-actions[bot]"
          git config user.email "github-actions[bot]@users.noreply.github.com"

      - name: Sync Main with Upstream
        run: |
          # Add the original repository as a remote named 'upstream'
          git remote add upstream https://github.com/PartialVolume/shredos.x86_64.git
          git fetch upstream
          
          # Switch to main and fast-forward to upstream/main
          git checkout main
          git merge upstream/master --ff-only
          git push origin main

      - name: Merge Main into Personal Branch
        run: |
          # Switch back to your personal branch
          git checkout PrimeWorkflow
          
          # Merge changes from the newly updated main
          # This creates a merge commit if your branch has diverged
          git merge main -m "Auto-merge upstream changes from main"
          git push origin PrimeWorkflow
